---
# Sync Living Room Light Groups
# Ensures all lights in a group stay in sync by stopping any Hue effects/loops
# before applying new state when controlled via HA/Alexa/Google/Siri

- id: sync_living_room_lamps_on_change
  alias: Sync Living Room Lamps on Change
  description: Stop effects and sync lights when Living Room Lamps Group is controlled
  trigger:
    - platform: state
      entity_id: light.living_room_lamps_group
  condition:
    # Only run if the change came from a service call (HA/Alexa/etc), not from Hue directly
    - condition: template
      value_template: "{{ trigger.to_state.context.parent_id is none }}"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.living_room_hue_iris
          - light.living_room_floor_lamp_2
          - light.living_room_floor_lamp
      data:
        effect: "none"  # Stop any running effects
        brightness: "{{ state_attr('light.living_room_lamps_group', 'brightness') }}"
        color_temp: "{{ state_attr('light.living_room_lamps_group', 'color_temp') }}"
        rgb_color: "{{ state_attr('light.living_room_lamps_group', 'rgb_color') }}"
        transition: 1
  mode: restart

- id: sync_living_room_lights_on_change
  alias: Sync Living Room Lights on Change
  description: Stop effects and sync lights when Living Room Lights group is controlled
  trigger:
    - platform: state
      entity_id: light.living_room_lights
  condition:
    # Only run if the change came from a service call (HA/Alexa/etc), not from Hue directly
    - condition: template
      value_template: "{{ trigger.to_state.context.parent_id is none }}"
  action:
    - service: light.turn_on
      target:
        entity_id:
          - light.living_room_ceiling
          - light.living_room_tv_light
          - light.living_room_floor_lamp_2
          - light.living_room_floor_lamp
          - light.living_room_hue_iris
      data:
        effect: "none"  # Stop any running effects
        brightness: "{{ state_attr('light.living_room_lights', 'brightness') }}"
        color_temp: "{{ state_attr('light.living_room_lights', 'color_temp') }}"
        rgb_color: "{{ state_attr('light.living_room_lights', 'rgb_color') }}"
        transition: 1
  mode: restart
