activate_alexa_actionable_notification:
  alias: activate_alexa_actionable_notification
  description: Activates an actionable notification on a specific echo device
  fields:
    text:
      description: The text you would like alexa to speak.
      example: What would you like the thermostat set to?
    event_id:
      description: Correlation ID for event responses
      example: ask_for_temperature
    alexa_device:
      description: Alexa device you want to trigger
      example: media_player.bedroom_echo
    suppress_confirmation:
      description: Set true if you want to suppress 'okay' confirmation
      example: 'true'
  sequence:
  - action: input_text.set_value
    target:
      entity_id: input_text.alexa_actionable_notification
    data_template:
      value: '{"text": "{{ text }}", "event": "{{ event_id }}", "suppress_confirmation":
        "{{ suppress_confirmation  | default("true") }}"}'
  - action: media_player.play_media
    target:
      entity_id: '{{ alexa_device }}'
    data_template:
      media_content_type: skill
      media_content_id: amzn1.ask.skill.de2ac1ef-e889-42a4-b9a7-8643315d762f
  mode: single
shared_bedroom_bedtime_routine:
  alias: Shared Bedroom Bedtime Routine
  mode: single
  sequence:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.smart_tv_pro
        state: 'on'
      sequence:
      - data:
          entity_id: media_player.smart_tv_pro
          is_volume_muted: true
        action: media_player.volume_mute
  - delay: 00:00:02
  - variables:
      echo_device: media_player.bedroom_echo
      alarm_event_id: set_alarm_prompt_bedroom
      room_bypass: input_boolean.bypass_primary_bedroom
      lights:
      - light.bedroom_ceiling_lights
      - light.bedroom_nightstands
      - light.bedroom_lights_group
  - target:
      entity_id: '{{ lights }}'
    action: light.turn_off
  - target:
      entity_id: '{{ room_bypass }}'
    action: input_boolean.turn_on
  - data:
      entity_id: '{{ echo_device }}'
      volume_level: 0.3
    action: media_player.volume_set
  - data:
      text: "{% set tomorrow = (now().date() + timedelta(days=1)).isoformat() %} {%
        set is_holiday = state_attr('calendar.united_states_md', 'start_time')[:10]
        == tomorrow %} {% if is_holiday %}\n  Tomorrow is a holiday. Do you still
        want to set a wake-up alarm?\n{% elif now().weekday() == 4 %}\n  It's Friday
        — the weekend starts tomorrow. Do you still want to set a wake-up alarm?\n{%
        elif now().weekday() == 6 %}\n  It's Sunday night — do you want to set an
        alarm for Monday?\n{% else %}\n  Would you like to set a wake-up alarm?\n{%
        endif %}"
      event_id: '{{ alarm_event_id }}'
      alexa_device: '{{ echo_device }}'
      suppress_confirmation: 'true'
    action: script.activate_alexa_actionable_notification
  - delay: 00:00:02
  - wait_for_trigger:
    - platform: event
      event_type: alexa_actionable_notification
      event_data:
        event_id: '{{ alarm_event_id }}'
    timeout: 00:00:05
    continue_on_timeout: true
  - variables:
      wait_result_alarm: '{{ wait.trigger }}'
  - data:
      title: Alexa Response Debug
      message: 'Alarm Prompt Response: {{ wait_result_alarm.event.data.event_response
        if wait_result_alarm is defined else ''no response'' }} Person ID: {{ wait_result_alarm.event.data.event_person_id
        | default(''unknown'') }}'
    action: persistent_notification.create
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ wait_result_alarm is defined and wait_result_alarm.event.data.event_response
          == ''ResponseYes'' }}'
      sequence:
      - action: script.ask_alarm_time
  - action: script.ask_thunderstorm_sounds
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.smart_tv_pro
        state: 'on'
      sequence:
      - data:
          entity_id: media_player.smart_tv_pro
          is_volume_muted: false
        action: media_player.volume_mute
lower_tv_mount_momentary:
  alias: Lower TV Mount (Momentary - Inverted)
  sequence:
  - service: switch.turn_off
    target:
      entity_id: switch.lower_tv
  - delay: '00:00:00.5'
  - service: switch.turn_on
    target:
      entity_id: switch.lower_tv
raise_tv_mount_momentary:
  alias: Raise TV Mount (Momentary - Inverted)
  sequence:
  - target:
      entity_id: switch.raise_tv
    action: switch.turn_off
  - delay: '00:00:00.5'
  - target:
      entity_id: switch.raise_tv
    action: switch.turn_on
  - delay: '00:00:00.5'
  - target:
      entity_id: switch.lower_tv
    action: switch.turn_on
re_sync_tv_mount_with_tv_power:
  alias: Re-sync TV Mount with TV Power
  sequence:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.living_room_tv
        state: 'on'
      - condition: state
        entity_id: input_boolean.tv_mount_should_be_down
        state: 'off'
      sequence:
      - service: script.lower_tv_mount_momentary
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.tv_mount_should_be_down
    - conditions:
      - condition: state
        entity_id: media_player.living_room_tv
        state: 'off'
      - condition: state
        entity_id: input_boolean.tv_mount_should_be_down
        state: 'on'
      sequence:
      - service: script.raise_tv_mount_momentary
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.tv_mount_should_be_down
notify_custom_alert:
  alias: Notify Custom Alert
  description: Send presence-aware mobile + Alexa alerts and enable nagging.
  fields:
    message:
      description: The alert message to send
      required: true
      example: Hey! The Litterbot is broken. Fix it or suffer feline consequences.
    title:
      description: The title for the mobile push notification
      required: false
      default: Home Assistant Alert
    nag_boolean:
      description: Input boolean to enable nag loop
      example: input_boolean.litterbot_nag_enabled
      required: false
  sequence:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ nag_boolean is defined and nag_boolean != '''' }}'
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: '{{ nag_boolean }}'
  - condition: state
    entity_id: person.ankit_aggarwal
    state: home
  - service: notify.mobile_app_ankit_s_iphone
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - condition: state
    entity_id: person.danielle_goodwin
    state: home
  - service: notify.mobile_app_pixel_7a
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - condition: state
    entity_id: person.max_aggarwal
    state: home
  - service: notify.mobile_app_luffy55
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - service: notify.alexa_media
    data:
      target:
      - media_player.living_room_alexa
      - media_player.kitchen_echo
      - media_player.kitchen_2
      - media_player.living_room_soundbar_2
      - media_player.ankit_s_sonos_arc
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: or
    conditions:
    - condition: state
      entity_id: person.ankit_aggarwal
      state: home
    - condition: state
      entity_id: person.danielle_goodwin
      state: home
  - service: notify.alexa_media
    data:
      target: media_player.bedroom_echo
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.max_aggarwal
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.max_s_bedroom_echo
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.aiden_kampe
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.aiden_s_echo_show
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.zoe_aggarwal
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.zoe_s_room
      message: '{{ message }}'
      data:
        type: announce
        method: all
notify_custom_alert_nonag:
  alias: Notify Custom Alert (No Nag)
  description: Send presence-aware mobile + Alexa alerts without triggering a nag
    loop.
  fields:
    message:
      description: The alert message to send
      required: true
      example: The dishwasher is leaking!
    title:
      description: The title for the mobile push notification
      required: false
      default: Home Assistant Alert
  sequence:
  - condition: state
    entity_id: person.ankit_aggarwal
    state: home
  - service: notify.mobile_app_ankit_s_iphone
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - condition: state
    entity_id: person.danielle_goodwin
    state: home
  - service: notify.mobile_app_pixel_7a
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - condition: state
    entity_id: person.max_aggarwal
    state: home
  - service: notify.mobile_app_luffy55
    data:
      message: '{{ message }}'
      title: '{{ title }}'
  - service: notify.alexa_media
    data:
      target:
      - media_player.living_room_alexa
      - media_player.kitchen_echo
      - media_player.kitchen_2
      - media_player.living_room_soundbar_2
      - media_player.ankit_s_sonos_arc
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: or
    conditions:
    - condition: state
      entity_id: person.ankit_aggarwal
      state: home
    - condition: state
      entity_id: person.danielle_goodwin
      state: home
  - service: notify.alexa_media
    data:
      target: media_player.bedroom_echo
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.max_aggarwal
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.max_s_bedroom_echo
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.aiden_kampe
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.aiden_s_echo_show
      message: '{{ message }}'
      data:
        type: announce
        method: all
  - condition: state
    entity_id: person.zoe_aggarwal
    state: home
  - service: notify.alexa_media
    data:
      target: media_player.zoe_s_room
      message: '{{ message }}'
      data:
        type: announce
        method: all
notify_sequential_snark_alert:
  alias: Notify Sequential Snark Alert
  description: Escalating alert using Alexa announce/tts and Google TTS for Sonos
  sequence:
  - variables:
      msg_index: '{{ states(''input_number.litterbot_nag_message_index'') | int }}'
      messages:
      - Hey! The Litterbot is broken. Let's take care of business.
      - Still broken. Please fix it before the cat union calls a strike.
      - Seriously, it's been long enough. That bot isn't going to fix itself.
      - They've held it in long enough. Proceed to emergency cleanup mode.
      - 'You are now enemy #1 in the eyes of your cats. Fix. The. Robot.'
      - We're nearing DEFCON 1. Poopocalypse is imminent.
      - Fur will fly. Litter will scatter. Handle the situation.
      - 'This is not a drill. Litterbot status: shameful.'
      - Legends speak of a working Litterbot. Become that legend.
      - 'Last warning: save your soul, scoop the hole.'
      message: '{{ messages[msg_index % messages | length] }}'
      now_hour: '{{ now().hour }}'
  - target:
      entity_id: input_number.litterbot_nag_message_index
    action: input_number.increment
    data: {}
  - condition: or
    conditions:
    - condition: state
      entity_id: person.ankit_aggarwal
      state: home
    - condition: state
      entity_id: person.danielle_goodwin
      state: home
    - condition: state
      entity_id: person.max_aggarwal
      state: home
    - condition: state
      entity_id: person.zoe_aggarwal
      state: home
    - condition: state
      entity_id: person.aiden_kampe
      state: home
  - condition: state
    entity_id: person.ankit_aggarwal
    state: home
  - data:
      message: '{{ message }}'
      title: Litterbot Alert
    action: notify.mobile_app_ankit_s_iphone
  - condition: state
    entity_id: person.danielle_goodwin
    state: home
  - data:
      message: '{{ message }}'
      title: Litterbot Alert
    action: notify.mobile_app_pixel_7a
  - condition: and
    conditions:
    - condition: state
      entity_id: person.max_aggarwal
      state: home
    - condition: template
      value_template: '{{ now().hour < 21 }}'
  - data:
      message: '{{ message }}'
      title: Litterbot Alert
    action: notify.mobile_app_luffy55
  - data:
      target:
      - media_player.living_room_alexa
      - media_player.kitchen_echo
      - media_player.kitchen_2
      - media_player.ankit_s_sonos_arc
      message: '{{ message }}'
      data:
        type: tts
        method: all
    action: notify.alexa_media
  - condition: or
    conditions:
    - condition: state
      entity_id: person.ankit_aggarwal
      state: home
    - condition: state
      entity_id: person.danielle_goodwin
      state: home
  - data:
      target: media_player.bedroom_echo
      message: '{{ message }}'
      data:
        type: tts
        method: all
    action: notify.alexa_media
  - condition: and
    conditions:
    - condition: state
      entity_id: person.max_aggarwal
      state: home
    - condition: template
      value_template: '{{ now().hour < 21 }}'
  - data:
      target:
      - media_player.bedroom_echo
      message: '{{ message }}'
      data:
        type: tts
        method: all
    action: notify.alexa_media
  - condition: and
    conditions:
    - condition: state
      entity_id: person.zoe_aggarwal
      state: home
    - condition: template
      value_template: '{{ now().hour < 21 }}'
  - data:
      target: media_player.zoe_s_room
      message: '{{ message }}'
      data:
        type: tts
        method: all
    action: notify.alexa_media
  - condition: and
    conditions:
    - condition: state
      entity_id: person.aiden_kampe
      state: home
    - condition: template
      value_template: '{{ now().hour < 21 }}'
  - data:
      target: media_player.aiden_s_echo_show
      message: '{{ message }}'
      data:
        type: tts
        method: all
    action: notify.alexa_media
  - data:
      entity_id: media_player.living_room_soundbar_2
      message: '{{ message }}'
    action: tts.google_translate_say
